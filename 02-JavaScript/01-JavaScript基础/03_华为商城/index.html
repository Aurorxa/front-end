<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Document</title>
  <link href="./css/reset.css" rel="stylesheet">
  <link href="./css/common.css" rel="stylesheet">
  <link href="./css/index.css" rel="stylesheet">
</head>
<body>

  <!-- 商品 -->
  <div class="product wrapper">
    <!-- 面包屑 -->
    <div class="crumbs">
      <span class="item">首页</span>
      <span>&gt;</span>
      <span class="item">笔记本</span>
    </div>
    <!-- 过滤条件 -->
    <div class="filter-condition">
      <!-- 分类 -->
      <ul class="row category">
        <li class="item">分类：</li>
        <li class="item">笔记本</li>
        <li class="item">台式机</li>
        <li class="item">智慧屏</li>
      </ul>
      <!-- 服务优惠 -->
      <ul class="row discount">
        <li class="item">服务优惠：</li>
        <li class="item">仅看有货</li>
        <li class="item">分期免息</li>
        <li class="item">优惠商品</li>
      </ul>
      <!-- 排序 -->
      <ul class="row sort">
        <li class="item">排序：</li>
        <li class="item active">综合</li>
        <li class="item">最新</li>
        <li class="item">评论数</li>
        <li class="item">价格</li>
      </ul>
    </div>
    <!-- 商品列表 -->
    <ul class="product-list">
      <!-- <li class="item">
        <a href="#">
          <img alt="" class="album" src="./img/product_01.webp">
          <div class="title">HUAWEI MateBook E 12.6英寸</div>
          <div class="sub-title">预订立省300元|12期免息</div>
          <div class="price">￥6499</div>
          <ul class="tags">
            <li class="tag">分期免息</li>
            <li class="tag">赠送积分</li>
          </ul>
          <div class="comment">
            <div class="count">
              <span class="num">3990</span>
              人评价
            </div>
            <div class="percent">
              <span class="num">96%</span>
              好评
            </div>
          </div>
        </a>
      </li> -->
    </ul>
  </div>

  <script src="./data/data.js"></script>

  <script>
    // ① 动态展示商品列表数据
    let productEl = document.querySelector(".product-list")
    // ② 搜索条件
    let queryConditionList = document.querySelectorAll(".discount .item:not(.discount .item:first-child)");
    let queryFilterList = []
    queryConditionList.forEach(item => {
      item.onclick = function () {
        // 设置状态
        this.classList.toggle("active")
        // 保存查询条件的关键字
        if (this.classList.contains("active")) {
          queryFilterList.push(this.textContent.trim())
        } else {
          let index = queryFilterList.findIndex(item => this.textContent.trim() === item);
          queryFilterList.splice(index, 1)
        }
        // 对 resultList 进行过滤
        let filterResultList = resultList.filter(item => {
          const {services} = item;
          return queryFilterList.every(keyword => services.includes(keyword))
        })

        render(filterResultList)
      }
    })

    /**
     * 渲染数据
     * @param resultList
     */
    function render(resultList) {
      // 先清空数据
      productEl.innerHTML = ""
      // 再渲染数据
      for (let item of resultList) {
        // 获取页面所需要的数据
        const {shopH5Url, briefName, promotionInfo, price, goodRate, promoLabels, rateCount} = item
        // 创建 item 元素
        let itemEl = document.createElement("li")
        itemEl.classList.add("item")
        // 创建 a 元素
        let aEl = document.createElement("a")
        aEl.href = shopH5Url
        itemEl.append(aEl)
        // 创建 img 元素
        let imgEl = document.createElement("img");
        imgEl.classList.add("album")
        imgEl.src = "./img/product_01.webp"
        aEl.append(imgEl)
        // 创建 div.title元素
        let titleEl = document.createElement("div")
        titleEl.classList.add("title")
        titleEl.textContent = briefName
        aEl.append(titleEl)
        // 创建 div.sub-title 元素
        let subTitleEl = document.createElement("div")
        subTitleEl.classList.add("sub-title")
        subTitleEl.textContent = promotionInfo
        aEl.append(subTitleEl)
        // 创建 div.price 元素
        let priceEl = document.createElement("div")
        priceEl.classList.add("price")
        priceEl.textContent = `￥${price}`
        aEl.append(priceEl)
        // 创建 ul.tags 元素
        let tagsEl = document.createElement("ul")
        tagsEl.classList.add("tags")
        for (let promoLabel of promoLabels) {
          let tagEl = document.createElement("li")
          tagEl.classList.add("tag")
          tagEl.textContent = promoLabel
          tagsEl.append(tagEl)
        }
        aEl.append(tagsEl)
        // 创建 div.comment 元素
        let commentEl = document.createElement('div')
        commentEl.classList.add("comment")
        let countEL = document.createElement("div")
        countEL.classList.add("count")
        let countNumEL = document.createElement("span")
        countNumEL.classList.add("num")
        countNumEL.textContent = `${rateCount}人评价`
        countEL.append(countNumEL)
        commentEl.append(countEL)
        let percentEL = document.createElement("div")
        percentEL.classList.add("percent")
        let percentNumEL = document.createElement("span")
        percentNumEL.classList.add("num")
        percentNumEL.textContent = `${goodRate}%好评`
        percentEL.append(percentNumEL)
        commentEl.append(percentEL)
        aEl.append(commentEl)
        // 将 item 添加到页面上
        productEl.append(itemEl)
      }

      // 处理最后一样元素的样式，如果不足 4 个，让其左对齐
      for (let i = 0; i < 3; i++) {
        let itemEl = document.createElement("li")
        itemEl.classList.add("item")
        itemEl.classList.add("empty")
        productEl.append(itemEl)
      }
    }

    render(resultList)

  </script>
</body>
</html>